# CVE-2025-29631: OS Command Injection in Gardyn Home Kit

## Advisory

| Field | Value |
|-------|-------|
| **CVE** | CVE-2025-29631 |
| **ICSA** | [ICSA-26-055-03](https://www.cisa.gov/news-events/ics-advisories/icsa-26-055-03) |
| **CVSS 3.1** | 9.1 (Critical) |
| **Vector** | `CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:U/C:H/I:H/A:N` |
| **CWE** | CWE-78 (Improper Neutralization of Special Elements used in an OS Command) |
| **Researcher** | Gr0m |
| **Published** | 2026-02-24 |

## Product

| Field | Value |
|-------|-------|
| Vendor | Gardyn |
| Product | Gardyn Home Kit 1.0, 2.0, 3.0; Gardyn Studio 1.0, 2.0 |
| Component | Device firmware — `DMHandler.py` |
| Affected Versions | Firmware < master.619 |

## Summary

The Gardyn Home Kit `upgrade()` direct method in the device firmware does not sanitize input before passing content to `os.system()` for execution. An attacker who can invoke Azure IoT Hub direct methods on a device can inject arbitrary OS commands that execute as root.

## Vulnerable Code

**File:** `/usr/local/etc/gardyn/device/iot/DMHandler.py`

> **Source code removed** — Vulnerable source code has been removed from this public disclosure to reduce attacker enablement. Full technical details were provided to CISA and the vendor during coordinated disclosure.

All three parameters — `uri`, `path`, and `services` — are attacker-controlled and passed unsanitized to `os.system()`, which invokes `/bin/sh -c`. Standard shell metacharacters achieve arbitrary command execution.

## Exploitation

The `upgrade()` method is a registered Azure IoT Hub direct method. It can be invoked by any caller with IoT Hub credentials (see CVE-2025-1242).

All three parameters — `uri`, `path`, and `services` — accept shell metacharacters that achieve arbitrary command execution when passed to `os.system()`.

> **PoC details removed** — Exploitation code, injection payloads, and automation scripts have been removed from this public disclosure to reduce attacker enablement. The vulnerability description, impact assessment, and remediation guidance remain. Full technical details were provided to CISA and the vendor during coordinated disclosure.

## Impact

- Remote code execution as root on Gardyn devices using the shared credentials (verified on researcher's own device)
- No user interaction required
- No per-device authentication — credentials are shared across the fleet
- Demonstrated capabilities: arbitrary command execution, user account creation, SSH enablement, firewall modification, full filesystem access
- ~38,831 online devices exploitable at any time

## Post-Advisory Update (2026-02-27)

Firmware master.619 and master.622 do NOT fully remediate this vulnerability:

- **Firmware 619/622:** The vendor's fix replaced `os.system()` with character sanitization but removed the path prefix restriction (`startswith("/usr/local/etc/")`). This introduces an arbitrary file write regression (Gr0m-050, CVSS 9.8).
- **Firmware 622:** Downloads files via `wget` without integrity verification — no code signing, no hash checks. Combined with the path traversal, this enables RCE via unsigned download (Gr0m-051).
- **Both Python and C IoT services run simultaneously** — the `iot-controller.service` (vulnerable Python DMHandler) was never disabled by the firmware update.
- **Full remote root compromise demonstrated** on researcher's own device running latest firmware (Feb 6, 2026) via GraphQL `SendGenericMethod` mutation (Gr0m-032).

## Remediation

Gardyn recommends upgrading firmware to master.619 or later. Devices with network connectivity will receive automatic updates. See https://mygardyn.com/security/ for additional information.

**Recommended mitigations for device owners:**

- Isolate the Gardyn device on a dedicated VLAN or IoT network segment
- Monitor for unexpected outbound connections from the device
- Do not place the device on networks containing sensitive systems

**Recommended fix for the vendor:**

1. Replace `os.system()` with `subprocess.run()` using `shell=False` and explicit argument lists
2. Validate `uri` against an allowlist of update server domains
3. Validate `services` against an allowlist of known Gardyn service names
4. Validate `path` against an allowlist of permitted write locations

## Timeline

| Date | Event |
|------|-------|
| 2025-10-14 | Initial disclosure to vendor via support@mygardyn.com |
| 2025-12-11 | Disclosure to CERT/CC |
| 2025-12-12 | CERT/CC contacts vendor |
| 2026-01-19 | Vendor firmware update (master.583) — vulnerability persists |
| 2026-02-24 | ICSA-26-055-03 published |
| 2026-02-24 | Vendor announces firmware master.619 deployment |

## References

- [CVE-2025-29631 — CVE Record](https://www.cve.org/CVERecord?id=CVE-2025-29631)
- [ICSA-26-055-03](https://www.cisa.gov/news-events/ics-advisories/icsa-26-055-03)
- [CSAF JSON](https://raw.githubusercontent.com/cisagov/CSAF/develop/csaf_files/OT/white/2026/icsa-26-055-03.json)
- [CWE-78: Improper Neutralization of Special Elements used in an OS Command](https://cwe.mitre.org/data/definitions/78.html)

## Credit

Reported by Gr0m to CISA.
